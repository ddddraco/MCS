<!DOCTYPE html>
<html lang="zh">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>å¤ªé˜³èƒ½æŠ•èµ„è’™ç‰¹å¡æ´›æ¨¡æ‹Ÿå™¨</title>
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <style>
    body {
      font-family: sans-serif;
      max-width: 900px;
      margin: auto;
      padding: 20px;
    }
    input {
      padding: 5px;
      width: 100px;
    }
    label {
      margin-right: 10px;
    }
    .input-group {
      margin-bottom: 10px;
    }
    button {
      padding: 8px 16px;
      font-size: 16px;
      margin-top: 10px;
    }
    #results {
      margin-top: 30px;
    }
  </style>
</head>
<body>
  <h1>â˜€ï¸ å¤ªé˜³èƒ½æŠ•èµ„è’™ç‰¹å¡æ´›æ¨¡æ‹Ÿå™¨</h1>

  <div class="input-group">
    <label>å®‰è£…æˆæœ¬ï¼š</label><input type="number" id="cost" value="50000" /> å…ƒ
  </div>
  <div class="input-group">
    <label>å¹´å‘ç”µé‡ï¼š</label><input type="number" id="production" value="1500" /> kWh
  </div>
  <div class="input-group">
    <label>ç”µä»·ï¼ˆèµ·å§‹ï¼‰ï¼š</label><input type="number" id="price" value="0.6" step="0.01" /> å…ƒ/kWh
  </div>
  <div class="input-group">
    <label>å…‰ç…§æ•ˆç‡å‡å€¼ï¼š</label><input type="number" id="sunMean" value="0.8" step="0.01" />
    <label>æ ‡å‡†å·®ï¼š</label><input type="number" id="sunStd" value="0.1" step="0.01" />
  </div>
  <div class="input-group">
    <label>ç”µä»·å¢é•¿ç‡å‡å€¼ï¼š</label><input type="number" id="growthMean" value="0.02" step="0.01" />
    <label>æ ‡å‡†å·®ï¼š</label><input type="number" id="growthStd" value="0.03" step="0.01" />
  </div>

  <button onclick="runSimulation()">å¼€å§‹æ¨¡æ‹Ÿ</button>

  <div id="results"></div>

  <canvas id="chart" height="100"></canvas>

  <script>
    function randNorm(mean, stdDev) {
      // Box-Muller transform
      let u1 = Math.random();
      let u2 = Math.random();
      let randStdNormal = Math.sqrt(-2 * Math.log(u1)) * Math.cos(2 * Math.PI * u2);
      return mean + stdDev * randStdNormal;
    }

    function runSimulation() {
      const cost = parseFloat(document.getElementById("cost").value);
      const prod = parseFloat(document.getElementById("production").value);
      const priceStart = parseFloat(document.getElementById("price").value);
      const sunMean = parseFloat(document.getElementById("sunMean").value);
      const sunStd = parseFloat(document.getElementById("sunStd").value);
      const growthMean = parseFloat(document.getElementById("growthMean").value);
      const growthStd = parseFloat(document.getElementById("growthStd").value);

      const years = 20;
      const simulations = 100;
      const finalSavings = [];

      for (let i = 0; i < simulations; i++) {
        let price = priceStart;
        let total = 0;
        for (let y = 1; y <= years; y++) {
          let sunlight = randNorm(sunMean, sunStd);
          price *= 1 + randNorm(growthMean, growthStd);
          let savings = prod * sunlight * price;
          total += savings;
        }
        finalSavings.push(total);
      }

      const breakEvenCount = finalSavings.filter(v => v >= cost).length;
      const avg = finalSavings.reduce((a, b) => a + b, 0) / simulations;
      const max = Math.max(...finalSavings);
      const min = Math.min(...finalSavings);

      document.getElementById("results").innerHTML = `
        <h2>ğŸ“Š æ¨¡æ‹Ÿç»“æœ</h2>
        <p>æ¨¡æ‹Ÿæ¬¡æ•°ï¼š${simulations}</p>
        <p>å¹³å‡æ€»æ”¶ç›Šï¼š<strong>Â¥${avg.toFixed(0)}</strong></p>
        <p>å›æœ¬æ¦‚ç‡ï¼ˆæ”¶ç›Š â‰¥ Â¥${cost}ï¼‰ï¼š<strong>${((breakEvenCount / simulations) * 100).toFixed(1)}%</strong></p>
        <p>æœ€é«˜æ”¶ç›Šï¼šÂ¥${max.toFixed(0)}ï¼Œæœ€ä½æ”¶ç›Šï¼šÂ¥${min.toFixed(0)}</p>
      `;

      renderChart(finalSavings);
    }

    function renderChart(data) {
      const bins = Array(10).fill(0);
      const min = Math.min(...data);
      const max = Math.max(...data);
      const range = max - min;

      data.forEach(val => {
        let index = Math.floor((val - min) / range * bins.length);
        if (index >= bins.length) index = bins.length - 1;
        bins[index]++;
      });

      const labels = bins.map((_, i) => {
        const low = min + (range / bins.length) * i;
        return `Â¥${Math.round(low)}`;
      });

      if (window.myChart) window.myChart.destroy();
      const ctx = document.getElementById("chart").getContext("2d");
      window.myChart = new Chart(ctx, {
        type: 'bar',
        data: {
          labels: labels,
          datasets: [{
            label: 'æ¨¡æ‹Ÿæ”¶ç›Šåˆ†å¸ƒ',
            data: bins,
            backgroundColor: 'rgba(75, 192, 192, 0.6)'
          }]
        },
        options: {
          responsive: true,
          plugins: {
            legend: { display: false }
          }
        }
      });
    }
  </script>
</body>
</html>