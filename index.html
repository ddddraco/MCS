<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Solar Investment Monte Carlo Simulator</title>
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <style>
    body {
      font-family: sans-serif;
      margin: 0;
      padding: 0;
      background: #f6f8fa;
    }

    header {
      background: #0d9488;
      color: white;
      padding: 1rem;
      text-align: center;
    }

    .container {
      display: flex;
      flex-wrap: wrap;
      padding: 1rem;
      gap: 1rem;
      max-width: 1200px;
      margin: auto;
    }

    .left, .right {
      background: white;
      border-radius: 8px;
      padding: 1rem;
      box-shadow: 0 0 10px rgba(0, 0, 0, 0.05);
    }

    .left {
      flex: 1 1 300px;
      min-width: 280px;
    }

    .right {
      flex: 2 1 500px;
    }

    .input-group {
      margin-bottom: 12px;
    }

    label {
      display: inline-block;
      width: 160px;
      font-weight: bold;
    }

    input {
      padding: 6px;
      width: 100px;
    }

    button {
      margin-top: 10px;
      padding: 8px 16px;
      background: #0d9488;
      color: white;
      border: none;
      cursor: pointer;
      border-radius: 4px;
    }

    #results {
      margin-top: 20px;
    }

    canvas {
      margin-top: 20px;
    }

    @media (max-width: 768px) {
      .container {
        flex-direction: column;
      }
    }
  </style>
</head>
<body>
  <header>
    <h1>Solar Investment Monte Carlo Simulator</h1>
    <p>Estimate potential return on investment over 20 years</p>
  </header>

  <div class="container">
    <div class="left">
      <div class="input-group">
        <label>Installation cost:</label><input type="number" id="cost" value="6500" /> â‚¬
      </div>
      <div class="input-group">
        <label>Annual production:</label><input type="number" id="production" value="5000" /> kWh
      </div>
      <div class="input-group">
        <label>Starting electricity price:</label><input type="number" id="price" value="0.38" step="0.01" /> â‚¬/kWh
      </div>
      <div class="input-group">
        <label>Sunlight efficiency mean:</label><input type="number" id="sunMean" value="0.85" step="0.01" />
      </div>
      <div class="input-group">
        <label>Sunlight std deviation:</label><input type="number" id="sunStd" value="0.05" step="0.01" />
      </div>
      <div class="input-group">
        <label>Price growth mean:</label><input type="number" id="growthMean" value="0.03" step="0.01" />
      </div>
      <div class="input-group">
        <label>Growth std deviation:</label><input type="number" id="growthStd" value="0.02" step="0.01" />
      </div>
      <button onclick="runSimulation()">Run Simulation</button>
    </div>

    <div class="right">
      <div id="results">
        <p>Please click "Run Simulation" to view results.</p>
      </div>
      <canvas id="chart" height="120"></canvas>
    </div>
  </div>

  <script>
    function randNorm(mean, stdDev) {
      let u1 = Math.random();
      let u2 = Math.random();
      let randStdNormal = Math.sqrt(-2 * Math.log(u1)) * Math.cos(2 * Math.PI * u2);
      return mean + stdDev * randStdNormal;
    }

    function runSimulation() {
      const cost = parseFloat(document.getElementById("cost").value);
      const prod = parseFloat(document.getElementById("production").value);
      const priceStart = parseFloat(document.getElementById("price").value);
      const sunMean = parseFloat(document.getElementById("sunMean").value);
      const sunStd = parseFloat(document.getElementById("sunStd").value);
      const growthMean = parseFloat(document.getElementById("growthMean").value);
      const growthStd = parseFloat(document.getElementById("growthStd").value);

      const years = 20;
      const simulations = 1000;
      const finalSavings = [];

      for (let i = 0; i < simulations; i++) {
        let price = priceStart;
        let total = 0;
        for (let y = 1; y <= years; y++) {
          let sunlight = randNorm(sunMean, sunStd);
          price *= 1 + randNorm(growthMean, growthStd);
          let savings = prod * sunlight * price;
          total += savings;
        }
        finalSavings.push(total);
      }

      const breakEvenCount = finalSavings.filter(v => v >= cost).length;
      const avg = finalSavings.reduce((a, b) => a + b, 0) / simulations;
      const max = Math.max(...finalSavings);
      const min = Math.min(...finalSavings);

      document.getElementById("results").innerHTML = `
        <h2>ðŸ“Š Simulation Results</h2>
        <p>Simulations run: ${simulations}</p>
        <p>Average total savings: <strong>â‚¬${avg.toFixed(0)}</strong></p>
        <p>Break-even probability (â‰¥ â‚¬${cost}): <strong>${((breakEvenCount / simulations) * 100).toFixed(1)}%</strong></p>
        <p>Max savings: â‚¬${max.toFixed(0)}, Min savings: â‚¬${min.toFixed(0)}</p>
      `;

      renderChart(finalSavings);
    }

    function renderChart(data) {
      const bins = Array(20).fill(0);
      const min = Math.min(...data);
      const max = Math.max(...data);
      const range = max - min;

      data.forEach(val => {
        let index = Math.floor((val - min) / range * bins.length);
        if (index >= bins.length) index = bins.length - 1;
        bins[index]++;
      });

      const labels = bins.map((_, i) => {
        const low = min + (range / bins.length) * i;
        return `â‚¬${Math.round(low)}`;
      });

      if (window.myChart) window.myChart.destroy();
      const ctx = document.getElementById("chart").getContext("2d");
      window.myChart = new Chart(ctx, {
        type: 'bar',
        data: {
          labels: labels,
          datasets: [{
            label: 'Savings distribution',
            data: bins,
            backgroundColor: 'rgba(75, 192, 192, 0.6)'
          }]
        },
        options: {
          responsive: true,
          plugins: {
            legend: { display: false }
          }
        }
      });
    }
  </script>
</body>
</html>
